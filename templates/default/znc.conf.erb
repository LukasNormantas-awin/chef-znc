// ZNC Configuration
// See also http://en.znc.in/wiki/Configuration
//
// Automagically generated by Chef for <%= node["fqdn"] %>.
// All local changes will be overwritten.

AnonIPLimit  = 10
MaxBufferSize= <%= node["znc"]["max_buffer_size"] %>
SSLCertFile  = /etc/znc/znc.pem
Listener4    = +<%= node["znc"]["port"] %>
ConnectDelay = 5
ServerThrottle = 30
Skin         = <%= node["znc"]["skin"] %>
StatusPrefix = *
<% (node["znc"]["modules"] || {}).each do |mod,params| -%>
LoadModule   = <%= "#{mod} #{params}".strip  %>
<% end -%>

<% @users.each do |u| -%>
<User <%= u["id"]  %>>
  Pass = <%= u["znc"]["password_hash"] %>
  Nick = <%= u["znc"]["nick"] %>
  AltNick = <%= u["znc"]["alt_nick"] %>
  Ident = <%= u["id"] %>
  RealName = <%= u["name"] %>
  QuitMsg = Leaving
  ChanModes = +stn
  Buffer = 250
  KeepBuffer = true
  MultiClients = true
  BounceDCCs = true
  DenyLoadMod = false
  Admin = <%= u["groups"].include?("admin").to_s %>
  DenySetBindHost = true
  DCCLookupMethod = default
  TimestampFormat = [%H:%M:%S]
  AppendTimestamp = false
  PrependTimestamp = true
  TimezoneOffset = "0.00"
  JoinTries = 10
  MaxJoins = 5
  IRCConnectEnabled = true

  Allow = *

  <% (u["znc"]["modules"] || {}).each do |mod,params| -%>
  LoadModule = <%= "#{mod} #{params}".strip %>
  <% end -%>

  <% (u["znc"]["networks"] || {}).each do |name, config| -%>
  <Network <%= name %>>
    <% (config["servers"] || {}).each do |server, port| -%>
    Server = <%= "#{server} #{port}".strip %>
    <% end -%>

    <% (config["modules"] || {}).each do |mod, params| -%>
    LoadModule = <%= "#{mod} #{params}".strip %>
    <% end -%>

    <% (config["channels"] || {}).each do |channel, options| -%>
    <Chan <%= channel %>>
    </Chan>
    <% end -%>
  </Network>
  <% end -%>
</User>
<% end -%>
